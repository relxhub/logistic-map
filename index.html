<!DOCTYPE html>
<html>
<head>
    <title>Logistic Dispatcher</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body, html { height: 100%; margin: 0; padding: 0; font-family: sans-serif; }
        #map { height: 90%; width: 100%; }
        #controls { 
            height: 10%; background: #fff; display: flex; 
            align-items: center; justify-content: center; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); 
        }
        button {
            background-color: #2ea44f; color: white; border: none; 
            padding: 12px 24px; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer;
            width: 90%;
        }
        button:disabled { background-color: #ccc; }
    </style>
</head>
<body>

    <div id="map"></div>

    <div id="controls">
        <button id="btnConfirm" disabled>üìç ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö‡∏û‡∏±‡∏™‡∏î‡∏∏</button>
    </div>

    <script>
        let map;
        let marker;
        let selectedLocation = null;
        const tg = window.Telegram.WebApp;

        // ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
        tg.expand(); 

        function initMap() {
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û (‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
            const bangkok = { lat: 13.7563, lng: 100.5018 };
            
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 15,
                center: bangkok,
                disableDefaultUI: true, // ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏Å‡πÜ
                zoomControl: true,
                gestureHandling: "greedy" // ‡πÉ‡∏´‡πâ‡∏ô‡∏¥‡πâ‡∏ß‡∏•‡∏≤‡∏Å‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏•‡∏∑‡πà‡∏ô‡πÜ
            });

            // ‡πÄ‡∏û‡∏¥‡πà‡∏° Event ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏¥‡πâ‡∏°‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
            map.addListener("click", (e) => {
                placeMarker(e.latLng);
            });
        }

        function placeMarker(latLng) {
            // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏´‡∏°‡∏∏‡∏î‡πÄ‡∏Å‡πà‡∏≤ ‡πÉ‡∏´‡πâ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô
            if (marker) {
                marker.setMap(null);
            }

            // ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà
            marker = new google.maps.Marker({
                position: latLng,
                map: map,
                animation: google.maps.Animation.DROP
            });

            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°
            selectedLocation = {
                lat: latLng.lat(),
                lng: latLng.lng()
            };
            
            const btn = document.getElementById("btnConfirm");
            btn.disabled = false;
            btn.innerText = "‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö‡∏û‡∏±‡∏™‡∏î‡∏∏‡∏ô‡∏µ‡πâ";
            
            // ‡∏™‡∏±‡πà‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÄ‡∏ö‡∏≤‡πÜ (Haptic Feedback) ‡πÉ‡∏´‡πâ‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏î‡∏ï‡∏¥‡∏î
            tg.HapticFeedback.impactOccurred('medium');
        }

        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
        document.getElementById("btnConfirm").addEventListener("click", () => {
            if (selectedLocation) {
                // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏≤ Python Bot
                const data = JSON.stringify({
                    action: "set_pickup",
                    lat: selectedLocation.lat,
                    lng: selectedLocation.lng
                });
                tg.sendData(data); 
            }
        });
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAzn1_v_MRFa2FpMjEeVBsdRtZ4dfZPo4w&callback=initMap" async defer></script>
</body>
</html>